# StripeåŠŸèƒ½æ¢å¤æ€»ç»“

## ğŸ¯ é—®é¢˜åˆ†æ

æ‚¨ä¹‹å‰ç¡®å®é…ç½®è¿‡Stripeæ”¯ä»˜é“¾æ¥å’ŒåŠ¨æ€ä»·æ ¼åŠŸèƒ½ï¼Œä½†æ˜¯ï¼š

1. **ç¯å¢ƒå˜é‡é—®é¢˜**: `.env.local`ä¸­çš„Stripeå¯†é’¥æ˜¯å ä½ç¬¦å€¼
2. **APIé™çº§å¤„ç†**: æˆ‘ä¹‹å‰ä¿®æ”¹äº†APIä½¿å…¶åœ¨Stripeæœªé…ç½®æ—¶è¿”å›æ¼”ç¤ºæ¨¡å¼
3. **åŠŸèƒ½å®Œæ•´**: æ‚¨çš„åº”ç”¨ç¡®å®æœ‰å®Œæ•´çš„Stripeé›†æˆ

## âœ… å·²æ¢å¤çš„åŠŸèƒ½

### 1. åŠ¨æ€ä»·æ ¼é…ç½®
- **ä½ç½®**: `/merchant/events/new` (æ­¥éª¤3)
- **åŠŸèƒ½**: å•†å®¶å¯ä»¥é…ç½®å¤šä¸ªç¥¨ç§å’Œä»·æ ¼
- **å­—æ®µ**: 
  - ç¥¨ç§åç§° (Ticket Name)
  - ä»·æ ¼ (Price) - ä»¥ç¾åˆ†ä¸ºå•ä½
  - åº“å­˜ (Inventory)
  - ç”¨æˆ·é™è´­ (Limit per user)

### 2. Stripeæ”¯ä»˜é›†æˆ
- **APIç«¯ç‚¹**: `/api/checkout_sessions`
- **åŠŸèƒ½**: åˆ›å»ºStripe Checkoutä¼šè¯
- **æ”¯æŒ**: åŠ¨æ€ä»·æ ¼ã€åº“å­˜æ£€æŸ¥ã€ç”¨æˆ·è®¤è¯

### 3. Webhookå¤„ç†
- **ç«¯ç‚¹**: `/api/stripe/webhook`
- **äº‹ä»¶**: `checkout.session.completed`
- **åŠŸèƒ½**: ç”Ÿæˆç¥¨åŠ¡ã€æ›´æ–°åº“å­˜ã€å‘é€ç¡®è®¤

### 4. ç¥¨åŠ¡ç”Ÿæˆ
- **æœåŠ¡**: `lib/ticket-service.js`
- **åŠŸèƒ½**: ç”Ÿæˆç¥¨åŠ¡IDã€äºŒç»´ç ã€ä¿å­˜åˆ°æ•°æ®åº“
- **æ”¯æŒ**: Supabaseå’ŒPrismaåŒæ•°æ®åº“

## ğŸ”§ å½“å‰çŠ¶æ€

### âœ… å·²ä¿®å¤
- **APIå“åº”**: ç°åœ¨æ­£ç¡®è¿”å›500é”™è¯¯ï¼ˆStripeæœªé…ç½®ï¼‰
- **åŠ¨æ€ä»·æ ¼**: åŠŸèƒ½å®Œæ•´ï¼Œæ”¯æŒå¤šç¥¨ç§é…ç½®
- **æ”¯ä»˜æµç¨‹**: å®Œæ•´çš„Stripeé›†æˆä»£ç 
- **Webhookå¤„ç†**: å®Œæ•´çš„æ”¯ä»˜å®Œæˆå¤„ç†

### âš ï¸ éœ€è¦é…ç½®
- **Stripeå¯†é’¥**: éœ€è¦é…ç½®çœŸå®çš„Stripeå¯†é’¥
- **ç¯å¢ƒå˜é‡**: æ›´æ–°`.env.local`ä¸­çš„Stripeé…ç½®

## ğŸš€ é…ç½®æ­¥éª¤

### 1. è·å–Stripeå¯†é’¥
1. è®¿é—® [Stripe Dashboard](https://dashboard.stripe.com/)
2. é€‰æ‹© "Developers" > "API keys"
3. å¤åˆ¶æµ‹è¯•å¯†é’¥ï¼š
   - `Publishable key` (pk_test_...)
   - `Secret key` (sk_test_...)

### 2. é…ç½®Webhook
1. é€‰æ‹© "Developers" > "Webhooks"
2. æ·»åŠ ç«¯ç‚¹: `https://yourdomain.com/api/stripe/webhook`
3. é€‰æ‹©äº‹ä»¶: `checkout.session.completed`
4. å¤åˆ¶Signing secret (whsec_...)

### 3. æ›´æ–°ç¯å¢ƒå˜é‡
åœ¨`.env.local`ä¸­é…ç½®ï¼š

```bash
# Stripe Configuration
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_51...
STRIPE_SECRET_KEY=sk_test_51...
STRIPE_WEBHOOK_SECRET=whsec_...
```

## ğŸ§ª æµ‹è¯•æµç¨‹

### 1. åˆ›å»ºæ´»åŠ¨
1. è®¿é—® `/merchant/events/new`
2. å¡«å†™æ´»åŠ¨ä¿¡æ¯
3. é…ç½®ç¥¨ç§å’Œä»·æ ¼ï¼ˆæ­¥éª¤3ï¼‰
4. å‘å¸ƒæ´»åŠ¨

### 2. æµ‹è¯•è´­ä¹°
1. è®¿é—®æ´»åŠ¨é¡µé¢
2. é€‰æ‹©ç¥¨ç§å’Œæ•°é‡
3. å¡«å†™ç”¨æˆ·ä¿¡æ¯
4. ç‚¹å‡»è´­ä¹°æŒ‰é’®
5. è·³è½¬åˆ°Stripeæ”¯ä»˜é¡µé¢

### 3. æµ‹è¯•æ”¯ä»˜
1. ä½¿ç”¨æµ‹è¯•å¡å·: `4242 4242 4242 4242`
2. ä»»æ„æœªæ¥æ—¥æœŸå’ŒCVC
3. å®Œæˆæ”¯ä»˜
4. éªŒè¯ç¥¨åŠ¡ç”Ÿæˆ

## ğŸ“Š åŠŸèƒ½ç‰¹æ€§

### åŠ¨æ€ä»·æ ¼é…ç½®
```javascript
// æ”¯æŒå¤šç¥¨ç§é…ç½®
prices: [
  { 
    name: 'Early Bird', 
    amount_cents: 1500,  // $15.00
    inventory: 100,
    limit_per_user: 5
  },
  { 
    name: 'VIP', 
    amount_cents: 3000,  // $30.00
    inventory: 50,
    limit_per_user: 2
  }
]
```

### æ”¯ä»˜æµç¨‹
1. **ä»·æ ¼éªŒè¯**: æ£€æŸ¥Stripeæœ€ä½é‡‘é¢è¦æ±‚ï¼ˆ$0.50ï¼‰
2. **åº“å­˜æ£€æŸ¥**: éªŒè¯ç¥¨åŠ¡åº“å­˜
3. **ç”¨æˆ·è®¤è¯**: éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
4. **æ”¯ä»˜è·³è½¬**: åˆ›å»ºStripe Checkoutä¼šè¯
5. **æ”¯ä»˜å®Œæˆ**: Webhookå¤„ç†æ”¯ä»˜ç»“æœ
6. **ç¥¨åŠ¡ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆç¥¨åŠ¡å’ŒäºŒç»´ç 

### Webhookå¤„ç†
```javascript
// å¤„ç†æ”¯ä»˜å®Œæˆäº‹ä»¶
case 'checkout.session.completed':
  await handleCheckoutSessionCompleted(event.data.object);
  break;
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **é…ç½®Stripeå¯†é’¥** - æŒ‰ç…§ä¸Šè¿°æ­¥éª¤é…ç½®çœŸå®å¯†é’¥
2. **æµ‹è¯•æ”¯ä»˜æµç¨‹** - éªŒè¯å®Œæ•´è´­ä¹°æµç¨‹
3. **éƒ¨ç½²Webhook** - åœ¨ç”Ÿäº§ç¯å¢ƒé…ç½®Webhookç«¯ç‚¹

é…ç½®å®Œæˆåï¼Œæ‚¨çš„ç¥¨åŠ¡ç³»ç»Ÿå°†å®Œå…¨æ­£å¸¸å·¥ä½œï¼Œæ”¯æŒï¼š
- âœ… åŠ¨æ€ä»·æ ¼é…ç½®
- âœ… Stripeæ”¯ä»˜å¤„ç†
- âœ… ç¥¨åŠ¡ç”Ÿæˆå’ŒéªŒè¯
- âœ… åº“å­˜ç®¡ç†
- âœ… ç”¨æˆ·è®¤è¯

æ‚¨çš„åº”ç”¨ç¡®å®æœ‰å®Œæ•´çš„Stripeé›†æˆåŠŸèƒ½ï¼
