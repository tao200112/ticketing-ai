<!DOCTYPE html>
<html>
<head>
    <title>å•†å®¶æ´»åŠ¨è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .info { background: #d1ecf1; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” å•†å®¶æ´»åŠ¨è°ƒè¯•å·¥å…·</h1>
    
    <div class="debug-section info">
        <h2>1. æ£€æŸ¥å•†å®¶æ´»åŠ¨æ•°æ®</h2>
        <button onclick="checkMerchantEvents()">æ£€æŸ¥å•†å®¶æ´»åŠ¨</button>
        <div id="merchant-events-result"></div>
    </div>
    
    <div class="debug-section info">
        <h2>2. æ£€æŸ¥ç”¨æˆ·æ•°æ®</h2>
        <button onclick="checkUserData()">æ£€æŸ¥ç”¨æˆ·æ•°æ®</button>
        <div id="user-data-result"></div>
    </div>
    
    <div class="debug-section info">
        <h2>3. æµ‹è¯•æ´»åŠ¨è·¯ç”±</h2>
        <button onclick="testEventRoutes()">æµ‹è¯•è·¯ç”±</button>
        <div id="route-test-result"></div>
    </div>
    
    <div class="debug-section info">
        <h2>4. åˆ›å»ºæµ‹è¯•æ•°æ®</h2>
        <button onclick="createTestData()">åˆ›å»ºæµ‹è¯•æ•°æ®</button>
        <div id="test-data-result"></div>
    </div>
    
    <div class="debug-section info">
        <h2>5. ä¿®å¤æ•°æ®</h2>
        <button onclick="fixData()">ä¿®å¤æ•°æ®</button>
        <div id="fix-result"></div>
    </div>
    
    <script>
        function checkMerchantEvents() {
            const result = document.getElementById('merchant-events-result');
            result.innerHTML = '<p>æ­£åœ¨æ£€æŸ¥å•†å®¶æ´»åŠ¨æ•°æ®...</p>';
            
            try {
                const merchantEvents = JSON.parse(localStorage.getItem('merchantEvents') || '[]');
                
                let html = '<h3>å•†å®¶æ´»åŠ¨æ•°æ®:</h3>';
                html += `<p>æ´»åŠ¨æ•°é‡: ${merchantEvents.length}</p>`;
                
                if (merchantEvents.length > 0) {
                    html += '<h4>æ´»åŠ¨åˆ—è¡¨:</h4>';
                    merchantEvents.forEach((event, index) => {
                        const eventSlug = event.title
                            .toLowerCase()
                            .replace(/[^a-z0-9\s-]/g, '')
                            .replace(/\s+/g, '-')
                            .trim();
                        
                        html += `
                            <div style="margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                                <h5>æ´»åŠ¨ ${index + 1}:</h5>
                                <p><strong>ID:</strong> ${event.id}</p>
                                <p><strong>æ ‡é¢˜:</strong> ${event.title}</p>
                                <p><strong>ç”Ÿæˆçš„Slug:</strong> ${eventSlug}</p>
                                <p><strong>æè¿°:</strong> ${event.description}</p>
                                <p><strong>å¼€å§‹æ—¶é—´:</strong> ${event.startTime}</p>
                                <p><strong>ä½ç½®:</strong> ${event.location}</p>
                                <p><strong>ä»·æ ¼æ•°é‡:</strong> ${event.prices ? event.prices.length : 0}</p>
                                <a href="/events/${eventSlug}" target="_blank" style="color: #007bff;">æµ‹è¯•é“¾æ¥: /events/${eventSlug}</a>
                            </div>
                        `;
                    });
                } else {
                    html += '<p style="color: #dc3545;">âŒ æ²¡æœ‰æ‰¾åˆ°å•†å®¶æ´»åŠ¨æ•°æ®</p>';
                }
                
                result.innerHTML = html;
                
            } catch (error) {
                result.innerHTML = `<p style="color: #dc3545;">âŒ æ£€æŸ¥å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        function checkUserData() {
            const result = document.getElementById('user-data-result');
            result.innerHTML = '<p>æ­£åœ¨æ£€æŸ¥ç”¨æˆ·æ•°æ®...</p>';
            
            try {
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                const merchantUser = JSON.parse(localStorage.getItem('merchantUser') || '{}');
                
                let html = '<h3>ç”¨æˆ·æ•°æ®:</h3>';
                html += `<p>ç”¨æˆ·æ•°æ®: ${userData.id ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}</p>`;
                html += `<p>å•†å®¶ç”¨æˆ·: ${merchantUser.id ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}</p>`;
                
                if (userData.id) {
                    html += `<p>ç”¨æˆ·ID: ${userData.id}</p>`;
                    html += `<p>ç”¨æˆ·é‚®ç®±: ${userData.email}</p>`;
                    html += `<p>ç™»å½•çŠ¶æ€: ${userData.isLoggedIn ? 'å·²ç™»å½•' : 'æœªç™»å½•'}</p>`;
                }
                
                if (merchantUser.id) {
                    html += `<p>å•†å®¶ID: ${merchantUser.id}</p>`;
                    html += `<p>å•†å®¶é‚®ç®±: ${merchantUser.email}</p>`;
                }
                
                result.innerHTML = html;
                
            } catch (error) {
                result.innerHTML = `<p style="color: #dc3545;">âŒ æ£€æŸ¥å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        function testEventRoutes() {
            const result = document.getElementById('route-test-result');
            result.innerHTML = '<p>æ­£åœ¨æµ‹è¯•è·¯ç”±...</p>';
            
            const merchantEvents = JSON.parse(localStorage.getItem('merchantEvents') || '[]');
            
            if (merchantEvents.length === 0) {
                result.innerHTML = '<p style="color: #dc3545;">âŒ æ²¡æœ‰å•†å®¶æ´»åŠ¨æ•°æ®å¯ä»¥æµ‹è¯•</p>';
                return;
            }
            
            let html = '<h3>è·¯ç”±æµ‹è¯•:</h3>';
            
            merchantEvents.forEach((event, index) => {
                const eventSlug = event.title
                    .toLowerCase()
                    .replace(/[^a-z0-9\s-]/g, '')
                    .replace(/\s+/g, '-')
                    .trim();
                
                html += `
                    <div style="margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                        <p><strong>æ´»åŠ¨:</strong> ${event.title}</p>
                        <p><strong>Slug:</strong> ${eventSlug}</p>
                        <a href="/events/${eventSlug}" target="_blank" style="color: #007bff; text-decoration: none; padding: 5px 10px; background: #e3f2fd; border-radius: 4px;">æµ‹è¯•è®¿é—®: /events/${eventSlug}</a>
                    </div>
                `;
            });
            
            result.innerHTML = html;
        }
        
        function createTestData() {
            const result = document.getElementById('test-data-result');
            result.innerHTML = '<p>æ­£åœ¨åˆ›å»ºæµ‹è¯•æ•°æ®...</p>';
            
            try {
                // åˆ›å»ºæµ‹è¯•å•†å®¶æ´»åŠ¨
                const testEvent = {
                    id: 'test-event-' + Date.now(),
                    merchantId: 'test-merchant-123',
                    title: 'Test Event Title',
                    description: 'This is a test event created for debugging',
                    startTime: '2024-12-31T20:00:00.000Z',
                    endTime: '2025-01-01T02:00:00.000Z',
                    location: 'Test Venue',
                    poster: null,
                    prices: [
                        {
                            name: 'General Admission',
                            amount_cents: 2000,
                            inventory: 100,
                            limit_per_user: 4
                        }
                    ],
                    ticketsSold: 0,
                    totalTickets: 100,
                    revenue: 0,
                    createdAt: new Date().toISOString()
                };
                
                // ä¿å­˜åˆ° localStorage
                const existingEvents = JSON.parse(localStorage.getItem('merchantEvents') || '[]');
                existingEvents.push(testEvent);
                localStorage.setItem('merchantEvents', JSON.stringify(existingEvents));
                
                // åˆ›å»ºæµ‹è¯•ç”¨æˆ·
                const testUser = {
                    id: 'test-user-' + Date.now(),
                    email: 'test@example.com',
                    name: 'Test User',
                    isLoggedIn: true,
                    token: 'test-token-' + Date.now()
                };
                localStorage.setItem('userData', JSON.stringify(testUser));
                
                result.innerHTML = `
                    <div style="color: #28a745;">
                        <p>âœ… æµ‹è¯•æ•°æ®åˆ›å»ºæˆåŠŸï¼</p>
                        <p>æ´»åŠ¨: ${testEvent.title}</p>
                        <p>ç”¨æˆ·: ${testUser.name}</p>
                        <a href="/events/test-event-title" target="_blank" style="color: #007bff;">æµ‹è¯•æ´»åŠ¨é“¾æ¥</a>
                    </div>
                `;
                
            } catch (error) {
                result.innerHTML = `<p style="color: #dc3545;">âŒ åˆ›å»ºå¤±è´¥: ${error.message}</p>`;
            }
        }
        
        function fixData() {
            const result = document.getElementById('fix-result');
            result.innerHTML = '<p>æ­£åœ¨ä¿®å¤æ•°æ®...</p>';
            
            try {
                // æ£€æŸ¥å¹¶ä¿®å¤å•†å®¶æ´»åŠ¨æ•°æ®
                const merchantEvents = JSON.parse(localStorage.getItem('merchantEvents') || '[]');
                
                if (merchantEvents.length === 0) {
                    // åˆ›å»ºé»˜è®¤æ´»åŠ¨
                    const defaultEvent = {
                        id: 'default-event-' + Date.now(),
                        merchantId: 'default-merchant',
                        title: 'Default Event',
                        description: 'This is a default event',
                        startTime: '2024-12-31T20:00:00.000Z',
                        endTime: '2025-01-01T02:00:00.000Z',
                        location: 'Default Venue',
                        poster: null,
                        prices: [
                            {
                                name: 'Standard Ticket',
                                amount_cents: 1500,
                                inventory: 50,
                                limit_per_user: 2
                            }
                        ],
                        ticketsSold: 0,
                        totalTickets: 50,
                        revenue: 0,
                        createdAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem('merchantEvents', JSON.stringify([defaultEvent]));
                }
                
                // ç¡®ä¿ç”¨æˆ·æ•°æ®å­˜åœ¨
                const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                if (!userData.id) {
                    const testUser = {
                        id: 'user-' + Date.now(),
                        email: 'user@example.com',
                        name: 'Test User',
                        isLoggedIn: true,
                        token: 'token-' + Date.now()
                    };
                    localStorage.setItem('userData', JSON.stringify(testUser));
                }
                
                result.innerHTML = `
                    <div style="color: #28a745;">
                        <p>âœ… æ•°æ®ä¿®å¤å®Œæˆï¼</p>
                        <p>å•†å®¶æ´»åŠ¨æ•°é‡: ${JSON.parse(localStorage.getItem('merchantEvents') || '[]').length}</p>
                        <p>ç”¨æˆ·æ•°æ®: ${localStorage.getItem('userData') ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}</p>
                    </div>
                `;
                
            } catch (error) {
                result.innerHTML = `<p style="color: #dc3545;">âŒ ä¿®å¤å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æ•°æ®
        window.onload = function() {
            checkMerchantEvents();
            checkUserData();
        };
    </script>
</body>
</html>