<!DOCTYPE html>
<html>
<head>
    <title>ä¿®å¤æ‰€æœ‰é—®é¢˜</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 3px; }
        button:hover { background: #0056b3; }
        .fix-button { background: #28a745; }
        .fix-button:hover { background: #1e7e34; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ä¿®å¤æ‰€æœ‰é—®é¢˜</h1>
    
    <div class="section info">
        <h2>ğŸ“‹ é—®é¢˜è¯Šæ–­</h2>
        <p>è¿™ä¸ªå·¥å…·å°†å¸®åŠ©æ‚¨è¯Šæ–­å’Œä¿®å¤ä»¥ä¸‹é—®é¢˜ï¼š</p>
        <ul>
            <li>æ´»åŠ¨åœ¨ä¸»ç•Œé¢ä¸æ˜¾ç¤º</li>
            <li>Ridiculous Chicken æ´»åŠ¨æ— æ³•è¿›å…¥</li>
            <li>å•†å®¶åˆ›å»ºçš„æ´»åŠ¨æ— æ³•è®¿é—®</li>
            <li>è·¯ç”±å†²çªå’Œé‡å¤é¡µé¢è­¦å‘Š</li>
        </ul>
    </div>
    
    <div class="section">
        <h2>1. æ£€æŸ¥å½“å‰çŠ¶æ€</h2>
        <button onclick="checkStatus()">æ£€æŸ¥çŠ¶æ€</button>
        <div id="status-result"></div>
    </div>
    
    <div class="section">
        <h2>2. ä¿®å¤æ•°æ®é—®é¢˜</h2>
        <button onclick="fixData()" class="fix-button">ä¿®å¤æ•°æ®</button>
        <div id="fix-result"></div>
    </div>
    
    <div class="section">
        <h2>3. æµ‹è¯•è·¯ç”±</h2>
        <button onclick="testRoutes()">æµ‹è¯•è·¯ç”±</button>
        <div id="route-result"></div>
    </div>
    
    <div class="section">
        <h2>4. éªŒè¯ä¿®å¤</h2>
        <button onclick="verifyFix()">éªŒè¯ä¿®å¤</button>
        <div id="verify-result"></div>
    </div>
    
    <script>
        function checkStatus() {
            const result = document.getElementById('status-result');
            let html = '<h3>å½“å‰çŠ¶æ€æ£€æŸ¥:</h3>';
            
            try {
                // æ£€æŸ¥ç”¨æˆ·æ•°æ®
                const userData = localStorage.getItem('userData');
                if (userData) {
                    const user = JSON.parse(userData);
                    html += `<p>âœ… ç”¨æˆ·: ${user.name} (${user.isLoggedIn ? 'å·²ç™»å½•' : 'æœªç™»å½•'})</p>`;
                } else {
                    html += '<p>âŒ æ— ç”¨æˆ·æ•°æ®</p>';
                }
                
                // æ£€æŸ¥æ´»åŠ¨æ•°æ®
                const merchantEvents = JSON.parse(localStorage.getItem('merchantEvents') || '[]');
                html += `<p>ğŸ“Š å•†å®¶æ´»åŠ¨: ${merchantEvents.length} ä¸ª</p>`;
                
                if (merchantEvents.length > 0) {
                    html += '<h4>æ´»åŠ¨åˆ—è¡¨:</h4><ul>';
                    merchantEvents.forEach((event, index) => {
                        const slug = event.title.toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/\s+/g, '-').trim();
                        html += `<li>${event.title} â†’ <a href="/events/${slug}" target="_blank">/events/${slug}</a></li>`;
                    });
                    html += '</ul>';
                }
                
                result.innerHTML = html;
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ æ£€æŸ¥å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        function fixData() {
            const result = document.getElementById('fix-result');
            result.innerHTML = '<p>æ­£åœ¨ä¿®å¤æ•°æ®...</p>';
            
            try {
                // åˆ›å»ºæµ‹è¯•ç”¨æˆ·
                const testUser = {
                    id: 'test-user-' + Date.now(),
                    email: 'test@example.com',
                    name: 'Test User',
                    isLoggedIn: true,
                    token: 'test-token-' + Date.now(),
                    createdAt: new Date().toISOString()
                };
                localStorage.setItem('userData', JSON.stringify(testUser));
                
                // åˆ›å»ºæµ‹è¯•æ´»åŠ¨
                const testEvent = {
                    id: Date.now().toString(),
                    title: 'Test Event Title',
                    description: 'This is a test event for debugging',
                    startTime: '2025-10-25T20:00:00Z',
                    endTime: '2025-10-25T23:00:00Z',
                    location: 'Test Location',
                    prices: [{
                        name: 'Regular Ticket',
                        amount_cents: 1500,
                        inventory: 100,
                        limit_per_user: 5
                    }],
                    ticketsSold: 0,
                    totalTickets: 100,
                    revenue: 0,
                    createdAt: new Date().toISOString()
                };
                
                const existingEvents = JSON.parse(localStorage.getItem('merchantEvents') || '[]');
                existingEvents.push(testEvent);
                localStorage.setItem('merchantEvents', JSON.stringify(existingEvents));
                
                result.innerHTML = `
                    <div class="success">
                        <h3>âœ… æ•°æ®ä¿®å¤å®Œæˆ</h3>
                        <p>å·²åˆ›å»ºæµ‹è¯•ç”¨æˆ·å’Œæ´»åŠ¨æ•°æ®</p>
                        <p>ç°åœ¨å¯ä»¥æµ‹è¯•æ´»åŠ¨è®¿é—®äº†</p>
                    </div>
                `;
                
                // è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
                setTimeout(checkStatus, 100);
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ ä¿®å¤å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        function testRoutes() {
            const result = document.getElementById('route-result');
            result.innerHTML = '<p>æ­£åœ¨æµ‹è¯•è·¯ç”±...</p>';
            
            const routes = [
                { name: 'æµ‹è¯•è·¯ç”±', url: '/events/test-route' },
                { name: 'é»˜è®¤æ´»åŠ¨', url: '/events/ridiculous-chicken-night-event' },
                { name: 'æµ‹è¯•æ´»åŠ¨', url: '/events/test-event-title' }
            ];
            
            let html = '<h3>è·¯ç”±æµ‹è¯•ç»“æœ:</h3>';
            let completed = 0;
            
            routes.forEach(route => {
                fetch(route.url)
                    .then(response => {
                        if (response.ok) {
                            html += `<p>âœ… ${route.name}: æ­£å¸¸</p>`;
                        } else {
                            html += `<p>âŒ ${route.name}: å¤±è´¥ (${response.status})</p>`;
                        }
                        completed++;
                        if (completed === routes.length) {
                            result.innerHTML = html;
                        }
                    })
                    .catch(error => {
                        html += `<p>âŒ ${route.name}: é”™è¯¯ (${error.message})</p>`;
                        completed++;
                        if (completed === routes.length) {
                            result.innerHTML = html;
                        }
                    });
            });
        }
        
        function verifyFix() {
            const result = document.getElementById('verify-result');
            result.innerHTML = '<p>æ­£åœ¨éªŒè¯ä¿®å¤...</p>';
            
            setTimeout(() => {
                let html = '<h3>ä¿®å¤éªŒè¯:</h3>';
                
                // æ£€æŸ¥ç”¨æˆ·æ•°æ®
                const userData = localStorage.getItem('userData');
                if (userData) {
                    html += '<p>âœ… ç”¨æˆ·æ•°æ®æ­£å¸¸</p>';
                } else {
                    html += '<p>âŒ ç”¨æˆ·æ•°æ®ç¼ºå¤±</p>';
                }
                
                // æ£€æŸ¥æ´»åŠ¨æ•°æ®
                const merchantEvents = JSON.parse(localStorage.getItem('merchantEvents') || '[]');
                if (merchantEvents.length > 0) {
                    html += '<p>âœ… æ´»åŠ¨æ•°æ®æ­£å¸¸</p>';
                } else {
                    html += '<p>âŒ æ´»åŠ¨æ•°æ®ç¼ºå¤±</p>';
                }
                
                html += '<h4>æµ‹è¯•é“¾æ¥:</h4>';
                html += '<ul>';
                html += '<li><a href="/events/test-route" target="_blank">æµ‹è¯•è·¯ç”±</a></li>';
                html += '<li><a href="/events/ridiculous-chicken-night-event" target="_blank">é»˜è®¤æ´»åŠ¨</a></li>';
                html += '<li><a href="/events/test-event-title" target="_blank">æµ‹è¯•æ´»åŠ¨</a></li>';
                html += '</ul>';
                
                result.innerHTML = html;
            }, 1000);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
        window.onload = checkStatus;
    </script>
</body>
</html>
