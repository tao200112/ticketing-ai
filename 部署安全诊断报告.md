# ğŸ”’ éƒ¨ç½²å®‰å…¨è¯Šæ–­æŠ¥å‘Š

**é¡¹ç›®**: Next.js + Supabase + Stripe ç¥¨åŠ¡ç³»ç»Ÿ  
**è¯Šæ–­æ—¶é—´**: 2025å¹´1æœˆ25æ—¥  
**è¯Šæ–­èŒƒå›´**: ç¯å¢ƒå˜é‡ã€è®¤è¯ã€APIå®‰å…¨ã€RLSç­–ç•¥ã€ç”Ÿäº§ç¯å¢ƒä¸€è‡´æ€§

---

## ğŸ“‹ è¯Šæ–­æ¦‚è§ˆ

| æ¨¡å— | çŠ¶æ€ | é£é™©ç­‰çº§ | é—®é¢˜æ•°é‡ |
|------|------|----------|----------|
| ç¯å¢ƒå˜é‡é…ç½® | âš ï¸ | ä¸­ç­‰ | 2 |
| Supabaseè®¤è¯ | âŒ | é«˜ | 3 |
| APIå®‰å…¨ | âš ï¸ | ä¸­ç­‰ | 4 |
| ç®¡ç†å‘˜æƒé™ | âš ï¸ | ä¸­ç­‰ | 2 |
| ç”Ÿäº§ç¯å¢ƒä¸€è‡´æ€§ | âš ï¸ | ä¸­ç­‰ | 1 |

---

## 1ï¸âƒ£ ç¯å¢ƒå˜é‡æ£€æŸ¥

### âœ… æ£€æŸ¥ç»“æœ
- **NEXT_PUBLIC_SUPABASE_URL**: å·²é…ç½®
- **NEXT_PUBLIC_SUPABASE_ANON_KEY**: å·²é…ç½®  
- **SUPABASE_SERVICE_ROLE_KEY**: å·²é…ç½®

### âš ï¸ å‘ç°çš„é—®é¢˜

**é—®é¢˜1: ç¯å¢ƒå˜é‡æ–‡ä»¶ç¼ºå¤±**
- **æ–‡ä»¶**: `.env.local` ä¸å­˜åœ¨
- **å½±å“**: æœ¬åœ°å¼€å‘ç¯å¢ƒå˜é‡æœªå®šä¹‰
- **å»ºè®®**: åˆ›å»º `.env.local` æ–‡ä»¶å¹¶é…ç½®ç¯å¢ƒå˜é‡

**é—®é¢˜2: Verceléƒ¨ç½²é…ç½®ä¸å®Œæ•´**
- **æ–‡ä»¶**: `vercel.json`
- **é—®é¢˜**: ç¼ºå°‘ç¯å¢ƒå˜é‡é…ç½®
- **å»ºè®®**: åœ¨Vercel Dashboardä¸­é…ç½®ç¯å¢ƒå˜é‡ï¼Œæˆ–æ·»åŠ  `vercel.json` ç¯å¢ƒå˜é‡é…ç½®

### ğŸ“ éœ€è¦äººå·¥å¤æ ¸çš„æ–‡ä»¶
- `vercel.json` - æ·»åŠ ç¯å¢ƒå˜é‡é…ç½®
- `.env.local` - åˆ›å»ºæœ¬åœ°ç¯å¢ƒå˜é‡æ–‡ä»¶
- Vercel Dashboard - é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡

---

## 2ï¸âƒ£ Supabase Auth ä¼šè¯æ£€æŸ¥

### âŒ ä¸¥é‡é—®é¢˜

**é—®é¢˜1: æœªä½¿ç”¨Next.js App Routeræ¨èæ–¹å¼**
- **æ–‡ä»¶**: `lib/supabase.ts`, `lib/supabaseClient.js`
- **é—®é¢˜**: ä½¿ç”¨ `createClient()` è€Œé `createServerClient()`
- **é£é™©**: å®¢æˆ·ç«¯è®¤è¯ä¸å®‰å…¨ï¼Œä¼šè¯ç®¡ç†ä¸å½“
- **å»ºè®®**: é‡æ„ä¸ºä½¿ç”¨ `createServerClient()` å’Œ `cookies()`

**é—®é¢˜2: ç¼ºå°‘è¿è¡Œæ—¶é…ç½®**
- **æ–‡ä»¶**: `app/api/auth/login/route.js`, `app/api/auth/register/route.js`
- **é—®é¢˜**: ç¼ºå°‘ `export const runtime = 'nodejs'`
- **å½±å“**: å¯èƒ½å¯¼è‡´Edge Runtimeå…¼å®¹æ€§é—®é¢˜
- **å»ºè®®**: æ·»åŠ  `export const runtime = 'nodejs'`

**é—®é¢˜3: è®¤è¯æµç¨‹ä¸å®‰å…¨**
- **æ–‡ä»¶**: `app/api/auth/login/route.js`
- **é—®é¢˜**: ç›´æ¥ä½¿ç”¨anonym keyæŸ¥è¯¢ç”¨æˆ·è¡¨
- **é£é™©**: ç»•è¿‡RLSç­–ç•¥ï¼Œå®‰å…¨æ¼æ´
- **å»ºè®®**: ä½¿ç”¨Supabase Auth APIæˆ–service role key

### ğŸ“ éœ€è¦äººå·¥å¤æ ¸çš„æ–‡ä»¶
- `lib/supabase.ts` - é‡æ„ä¸ºserver client
- `lib/supabaseClient.js` - é‡æ„ä¸ºserver client  
- `app/api/auth/login/route.js` - æ·»åŠ runtimeé…ç½®
- `app/api/auth/register/route.js` - æ·»åŠ runtimeé…ç½®

---

## 3ï¸âƒ£ API ä¸ RLS æ£€æŸ¥

### âš ï¸ å‘ç°çš„é—®é¢˜

**é—®é¢˜1: ç®¡ç†å‘˜APIç¼ºå°‘èº«ä»½éªŒè¯**
- **æ–‡ä»¶**: `app/api/admin/orders/route.js`, `app/api/admin/tickets/route.js`
- **é—®é¢˜**: ç›´æ¥ä½¿ç”¨ `supabaseAdmin` æ— èº«ä»½éªŒè¯
- **é£é™©**: ä»»ä½•äººéƒ½å¯ä»¥è®¿é—®ç®¡ç†å‘˜æ•°æ®
- **å»ºè®®**: æ·»åŠ ç®¡ç†å‘˜èº«ä»½éªŒè¯ä¸­é—´ä»¶

**é—®é¢˜2: å•†å®¶æ³¨å†ŒAPIå®‰å…¨é£é™©**
- **æ–‡ä»¶**: `app/api/auth/register/route.js`
- **é—®é¢˜**: ä½¿ç”¨anonym keyæ’å…¥æ•°æ®
- **é£é™©**: å¯èƒ½ç»•è¿‡RLSç­–ç•¥
- **å»ºè®®**: ä½¿ç”¨service role keyæˆ–Supabase Auth

**é—®é¢˜3: ç¥¨æ®éªŒè¯APIæƒé™è¿‡å¤§**
- **æ–‡ä»¶**: `app/api/tickets/verify/route.js`
- **é—®é¢˜**: ä½¿ç”¨ `supabaseAdmin` æ— é™åˆ¶è®¿é—®
- **é£é™©**: æ•æ„Ÿæ•°æ®æš´éœ²
- **å»ºè®®**: æ·»åŠ é€‚å½“çš„æƒé™æ£€æŸ¥

**é—®é¢˜4: ç¼ºå°‘APIè·¯ç”±è¿è¡Œæ—¶é…ç½®**
- **æ–‡ä»¶**: å¤šä¸ªAPIè·¯ç”±æ–‡ä»¶
- **é—®é¢˜**: å¤§éƒ¨åˆ†APIè·¯ç”±ç¼ºå°‘ `runtime = 'nodejs'`
- **å½±å“**: å¯èƒ½å½±å“æ•°æ®åº“è¿æ¥å’Œæ€§èƒ½
- **å»ºè®®**: ä¸ºæ‰€æœ‰æ•°æ®åº“ç›¸å…³APIæ·»åŠ runtimeé…ç½®

### ğŸ“ éœ€è¦äººå·¥å¤æ ¸çš„æ–‡ä»¶
- `app/api/admin/orders/route.js` - æ·»åŠ èº«ä»½éªŒè¯
- `app/api/admin/tickets/route.js` - æ·»åŠ èº«ä»½éªŒè¯
- `app/api/tickets/verify/route.js` - æ·»åŠ æƒé™æ£€æŸ¥
- `app/api/events/create/route.ts` - æ·»åŠ runtimeé…ç½®

---

## 4ï¸âƒ£ Admin æƒé™ä¸æ•°æ®æ±‡æ€»æ£€æŸ¥

### âš ï¸ å‘ç°çš„é—®é¢˜

**é—®é¢˜1: ç®¡ç†å‘˜APIä½¿ç”¨service roleä½†ç¼ºå°‘éªŒè¯**
- **æ–‡ä»¶**: `app/api/admin/events/create/route.ts`
- **é—®é¢˜**: ä½¿ç”¨ `supabaseAdmin` ä½†æ— ç®¡ç†å‘˜èº«ä»½éªŒè¯
- **é£é™©**: ä»»ä½•äººéƒ½å¯ä»¥åˆ›å»ºæ´»åŠ¨
- **å»ºè®®**: æ·»åŠ ç®¡ç†å‘˜èº«ä»½éªŒè¯

**é—®é¢˜2: å‰ç«¯Admin Dashboardæ•°æ®æ‹‰å–**
- **æ–‡ä»¶**: `app/admin/dashboard/page.js`
- **é—®é¢˜**: ç›´æ¥è°ƒç”¨ç®¡ç†å‘˜APIï¼Œæ— èº«ä»½éªŒè¯
- **é£é™©**: å®¢æˆ·ç«¯å¯ä»¥ç»•è¿‡æƒé™æ£€æŸ¥
- **å»ºè®®**: æ·»åŠ å®¢æˆ·ç«¯èº«ä»½éªŒè¯æˆ–ä½¿ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“

### ğŸ“ éœ€è¦äººå·¥å¤æ ¸çš„æ–‡ä»¶
- `app/api/admin/events/create/route.ts` - æ·»åŠ ç®¡ç†å‘˜éªŒè¯
- `app/admin/dashboard/page.js` - æ·»åŠ èº«ä»½éªŒè¯
- æ‰€æœ‰ `app/api/admin/*` è·¯ç”± - ç»Ÿä¸€æ·»åŠ æƒé™æ£€æŸ¥

---

## 5ï¸âƒ£ ç”Ÿäº§ç¯å¢ƒä¸€è‡´æ€§

### âš ï¸ å‘ç°çš„é—®é¢˜

**é—®é¢˜1: RLSç­–ç•¥è¢«æ³¨é‡Š**
- **æ–‡ä»¶**: `supabase/migrations/partytix_mvp.sql`
- **é—®é¢˜**: æ‰€æœ‰RLSç­–ç•¥éƒ½è¢«æ³¨é‡Šæ‰
- **å½±å“**: æ•°æ®åº“æ— è¡Œçº§å®‰å…¨ä¿æŠ¤
- **å»ºè®®**: å¯ç”¨é€‚å½“çš„RLSç­–ç•¥

### ğŸ“ éœ€è¦äººå·¥å¤æ ¸çš„æ–‡ä»¶
- `supabase/migrations/partytix_mvp.sql` - å¯ç”¨RLSç­–ç•¥
- ç”Ÿäº§ç¯å¢ƒSupabaseé¡¹ç›® - ç¡®è®¤RLSç­–ç•¥å·²å¯ç”¨

---

## ğŸš¨ é«˜é£é™©é—®é¢˜æ±‡æ€»

### 1. è®¤è¯æ¶æ„é—®é¢˜ (é«˜ä¼˜å…ˆçº§)
- æœªä½¿ç”¨Next.js App Routeræ¨èçš„è®¤è¯æ–¹å¼
- å®¢æˆ·ç«¯è®¤è¯ä¸å®‰å…¨
- ç¼ºå°‘ä¼šè¯ç®¡ç†

### 2. APIå®‰å…¨æ¼æ´ (é«˜ä¼˜å…ˆçº§)  
- ç®¡ç†å‘˜APIæ— èº«ä»½éªŒè¯
- ä½¿ç”¨anonym keyè¿›è¡Œæ•æ„Ÿæ“ä½œ
- ç¼ºå°‘æƒé™æ£€æŸ¥

### 3. æ•°æ®åº“å®‰å…¨ (ä¸­ä¼˜å…ˆçº§)
- RLSç­–ç•¥è¢«ç¦ç”¨
- ç¼ºå°‘è¡Œçº§å®‰å…¨ä¿æŠ¤
- æ•°æ®è®¿é—®æ§åˆ¶ä¸å½“

---

## ğŸ”§ ä¿®å¤å»ºè®®

### ç«‹å³ä¿®å¤ (é«˜ä¼˜å…ˆçº§)
1. **é‡æ„è®¤è¯ç³»ç»Ÿ**: ä½¿ç”¨ `createServerClient()` å’Œ `cookies()`
2. **æ·»åŠ APIèº«ä»½éªŒè¯**: ä¸ºæ‰€æœ‰ç®¡ç†å‘˜APIæ·»åŠ èº«ä»½éªŒè¯
3. **å¯ç”¨RLSç­–ç•¥**: åœ¨Supabaseä¸­å¯ç”¨é€‚å½“çš„RLSç­–ç•¥

### çŸ­æœŸä¿®å¤ (ä¸­ä¼˜å…ˆçº§)
1. **æ·»åŠ è¿è¡Œæ—¶é…ç½®**: ä¸ºæ‰€æœ‰APIè·¯ç”±æ·»åŠ  `runtime = 'nodejs'`
2. **ç¯å¢ƒå˜é‡é…ç½®**: å®Œå–„Verceléƒ¨ç½²é…ç½®
3. **æƒé™æ£€æŸ¥**: æ·»åŠ é€‚å½“çš„æƒé™éªŒè¯

### é•¿æœŸä¼˜åŒ– (ä½ä¼˜å…ˆçº§)
1. **å®‰å…¨å®¡è®¡**: å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡
2. **ç›‘æ§ç³»ç»Ÿ**: æ·»åŠ å®‰å…¨ç›‘æ§
3. **æ–‡æ¡£æ›´æ–°**: æ›´æ–°å®‰å…¨æ–‡æ¡£

---

## ğŸ“Š å®‰å…¨è¯„åˆ†

| æ¨¡å— | å½“å‰è¯„åˆ† | ç›®æ ‡è¯„åˆ† | å·®è· |
|------|----------|----------|------|
| ç¯å¢ƒå˜é‡ | 6/10 | 9/10 | -3 |
| è®¤è¯ç³»ç»Ÿ | 3/10 | 9/10 | -6 |
| APIå®‰å…¨ | 5/10 | 9/10 | -4 |
| æ•°æ®åº“å®‰å…¨ | 4/10 | 9/10 | -5 |
| æ•´ä½“å®‰å…¨ | 4.5/10 | 9/10 | -4.5 |

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨ (æœ¬å‘¨å†…)
1. åˆ›å»º `.env.local` æ–‡ä»¶
2. é…ç½®Vercelç¯å¢ƒå˜é‡
3. å¯ç”¨Supabase RLSç­–ç•¥

### çŸ­æœŸè¡ŒåŠ¨ (2å‘¨å†…)
1. é‡æ„è®¤è¯ç³»ç»Ÿ
2. æ·»åŠ APIèº«ä»½éªŒè¯
3. å®Œå–„æƒé™æ£€æŸ¥

### é•¿æœŸè¡ŒåŠ¨ (1ä¸ªæœˆå†…)
1. å®‰å…¨å®¡è®¡
2. ç›‘æ§ç³»ç»Ÿ
3. æ–‡æ¡£å®Œå–„

---

**âš ï¸ é‡è¦æé†’**: åœ¨ä¿®å¤å®‰å…¨é—®é¢˜ä¹‹å‰ï¼Œå»ºè®®æš‚æ—¶é™åˆ¶ç”Ÿäº§ç¯å¢ƒçš„è®¿é—®æƒé™ï¼Œé¿å…å®‰å…¨æ¼æ´è¢«åˆ©ç”¨ã€‚

**ğŸ“ è”ç³»ä¿¡æ¯**: å¦‚éœ€æŠ€æœ¯æ”¯æŒï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿè¿›è¡Œè¯¦ç»†çš„å®‰å…¨ä¿®å¤æŒ‡å¯¼ã€‚
