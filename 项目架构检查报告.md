# é¡¹ç›®æ¶æ„æ£€æŸ¥æŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ—¶é—´
2025-01-27

## ğŸ” æ£€æŸ¥èŒƒå›´
1. å‰åç«¯åˆ†ç¦»çŠ¶æ€
2. æ•°æ®å­˜å‚¨æ–¹å¼ï¼ˆlocalStorage vs Supabaseï¼‰
3. éƒ¨ç½²çº¿ä¸Šå¯è¡Œæ€§
4. åŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•

---

## 1. å‰åç«¯åˆ†ç¦»çŠ¶æ€ âœ…

### åç«¯æ¶æ„
- **æ¡†æ¶**: Next.js API Routes (`app/api/`)
- **æ•°æ®å±‚**: Supabase PostgreSQL
- **æ”¯ä»˜**: Stripe API
- **è®¤è¯**: è‡ªå®šä¹‰è®¤è¯ç³»ç»Ÿ + Supabase

### APIç«¯ç‚¹
- `/api/auth/*` - ç”¨æˆ·è®¤è¯
- `/api/merchant/*` - å•†å®¶ç›¸å…³
- `/api/admin/*` - ç®¡ç†å‘˜ç›¸å…³
- `/api/events/*` - æ´»åŠ¨ç®¡ç†
- `/api/checkout_sessions` - Stripeæ”¯ä»˜
- `/api/orders/*` - è®¢å•ç®¡ç†
- `/api/webhook` - Stripe Webhook

### çŠ¶æ€: âœ… **å·²å®ç°å‰åç«¯åˆ†ç¦»**

---

## 2. æ•°æ®å­˜å‚¨æ£€æŸ¥

### 2.1 å·²è¿ç§»åˆ° Supabase âœ…
- âœ… **ç”¨æˆ·æ•°æ®** (`users`) - å­˜å‚¨åœ¨ Supabase
- âœ… **å•†å®¶æ•°æ®** (`merchants`) - å­˜å‚¨åœ¨ Supabase
- âœ… **æ´»åŠ¨æ•°æ®** (`events`) - å­˜å‚¨åœ¨ Supabase
- âœ… **ä»·æ ¼æ•°æ®** (`prices`) - å­˜å‚¨åœ¨ Supabase
- âœ… **è®¢å•æ•°æ®** (`orders`) - å­˜å‚¨åœ¨ Supabase
- âœ… **ç¥¨æ®æ•°æ®** (`tickets`) - å­˜å‚¨åœ¨ Supabase
- âœ… **é‚€è¯·ç ** (`admin_invite_codes`) - å­˜å‚¨åœ¨ Supabase

### 2.2 localStorage ä½¿ç”¨æƒ…å†µ âš ï¸

#### ä»…ç”¨äºä¼šè¯ç®¡ç† (å¯æ¥å—)
```javascript
// ç”¨æˆ·ä¼šè¯
localStorage.setItem('userSession', ...)  // ä»…å­˜å‚¨ä¼šè¯æ ‡è¯†
localStorage.getItem('userSession')       // ç”¨äºè®¤è¯æ£€æŸ¥
localStorage.removeItem('userSession')    // ç™»å‡ºæ—¶æ¸…ç†

// å•†å®¶ä¼šè¯
localStorage.setItem('merchantUser', ...)
localStorage.setItem('merchantToken', ...)

// ç®¡ç†å‘˜ä¼šè¯
localStorage.setItem('adminUser', ...)
localStorage.setItem('adminToken', ...)
```

#### é—ç•™çš„ localStorage ä½¿ç”¨ (éœ€æ¸…ç†)
```javascript
// âŒ ä»¥ä¸‹æ–‡ä»¶ä»ä½¿ç”¨ localStorage å­˜å‚¨æ•°æ®ï¼ˆéœ€åˆ é™¤æˆ–é‡æ„ï¼‰
app/admin/fix-production-data/page.js       // è°ƒè¯•é¡µé¢
app/debug-purchase/page.js                  // è°ƒè¯•é¡µé¢
app/debug-production/page.js                // è°ƒè¯•é¡µé¢
app/events/page.js                          // å°‘é‡äº‹ä»¶ç¼“å­˜
app/event/ridiculous-chicken/page.js        // æ”¯ä»˜æ•°æ®
app/events/ridiculous-chicken/page.js       // ç”¨æˆ·æ•°æ®ç¼“å­˜
lib/user-storage.js                         // æ—§çš„ç”¨æˆ·å­˜å‚¨ç³»ç»Ÿ
test-amount-display.js                      // æµ‹è¯•è„šæœ¬
```

### æ•°æ®æµæ€»ç»“
```
ç”¨æˆ·æ“ä½œ
    â†“
å‰ç«¯ç»„ä»¶ (React)
    â†“
API Routes (Next.js)
    â†“
Supabase (PostgreSQL)
    â†“
è¿”å›æ•°æ®åˆ°å‰ç«¯
    â†“
æ˜¾ç¤ºç»™ç”¨æˆ·
```

---

## 3. éƒ¨ç½²çº¿ä¸Šå¯è¡Œæ€§ âœ…

### 3.1 ç¯å¢ƒå˜é‡éœ€æ±‚
```bash
# Supabaseé…ç½®
NEXT_PUBLIC_SUPABASE_URL=xxx
NEXT_PUBLIC_SUPABASE_ANON_KEY=xxx
SUPABASE_SERVICE_ROLE_KEY=xxx

# Stripeé…ç½®
STRIPE_SECRET_KEY=xxx
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=xxx
STRIPE_WEBHOOK_SECRET=xxx
```

### 3.2 éƒ¨ç½²å‡†å¤‡ âœ…
- âœ… Next.js SSR/SSG æ”¯æŒ
- âœ… API Routes å¯éƒ¨ç½²
- âœ… ç¯å¢ƒå˜é‡é…ç½®
- âœ… Supabase è¿æ¥é…ç½®
- âœ… Stripe Webhook é…ç½®

### 3.3 æ½œåœ¨é—®é¢˜ âš ï¸
1. **qrcode.react å¯¼å…¥é”™è¯¯** - éœ€è¦ä¿®å¤
2. **éƒ¨åˆ†è°ƒè¯•é¡µé¢é—ç•™** - éœ€è¦åˆ é™¤
3. **Navbar äº‹ä»¶å¤„ç†å™¨é”™è¯¯** - æŒç»­å‡ºç°ä½†ä¸å½±å“åŠŸèƒ½

---

## 4. åŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•

### 4.1 ç”¨æˆ·åŠŸèƒ½ âœ…
- [x] ç”¨æˆ·æ³¨å†Œ - `/api/auth/register`
- [x] ç”¨æˆ·ç™»å½• - `/api/auth/login`
- [x] è´¦æˆ·é¡µé¢ - `/account` (ç¥¨åŠ¡å†å² + QRç )
- [x] è´­ç¥¨æµç¨‹ - Stripe æ”¯ä»˜
- [x] QRç ç”Ÿæˆ - æˆåŠŸé¡µé¢æ˜¾ç¤º

### 4.2 å•†å®¶åŠŸèƒ½ âœ…
- [x] å•†å®¶æ³¨å†Œ - `/api/merchant/create`
- [x] å•†å®¶ç™»å½• - `/api/merchant/login`
- [x] åˆ›å»ºæ´»åŠ¨ - `/api/events`
- [x] æ´»åŠ¨ç®¡ç† - `/merchant/events`
- [x] è´­ä¹°è®°å½• - `/merchant/purchases`
- [x] æ•°æ®ç»Ÿè®¡ - `/merchant`

### 4.3 ç®¡ç†å‘˜åŠŸèƒ½ âœ…
- [x] ç®¡ç†å‘˜ç™»å½• - `/api/admin/login`
- [x] ç»Ÿè®¡é¢æ¿ - `/api/admin/stats`
- [x] ç”¨æˆ·ç®¡ç† - `/api/admin/customers`
- [x] å•†å®¶ç®¡ç† - `/api/admin/merchants`
- [x] æ´»åŠ¨ç®¡ç† - `/api/admin/events`
- [x] ç¥¨æ®ç®¡ç† - `/api/admin/tickets`
- [x] é‚€è¯·ç ç®¡ç† - `/api/admin/invite-codes`

### 4.4 æ”¯ä»˜åŠŸèƒ½ âœ…
- [x] Stripe æ”¯ä»˜é›†æˆ
- [x] Webhook å¤„ç†
- [x] è®¢å•åˆ›å»º
- [x] ç¥¨æ®ç”Ÿæˆ
- [x] QRç ç”Ÿæˆ

---

## 5. å·²çŸ¥é—®é¢˜

### 5.1 ä¸¥é‡é—®é¢˜ âŒ
1. **qrcode.react å¯¼å…¥é”™è¯¯**
   - æ–‡ä»¶: `app/account/page.js`
   - é”™è¯¯: `Attempted import error: 'qrcode.react' does not contain a default export`
   - è§£å†³æ–¹æ¡ˆ: ä¿®å¤å¯¼å…¥è¯­å¥

### 5.2 è­¦å‘Šä¿¡æ¯ âš ï¸
1. **Navbar äº‹ä»¶å¤„ç†å™¨é”™è¯¯**
   - æ–‡ä»¶: `components/NavbarPartyTix.js`
   - é”™è¯¯: `Event handlers cannot be passed to Client Component props`
   - å½±å“: ä¸å½±å“åŠŸèƒ½ï¼Œä½†æŒç»­åœ¨æ§åˆ¶å°æ˜¾ç¤º

2. **é—ç•™çš„è°ƒè¯•é¡µé¢**
   - å¤šä¸ªè°ƒè¯•å’Œæµ‹è¯•é¡µé¢ä»åœ¨ä½¿ç”¨ localStorage
   - å»ºè®®: åˆ é™¤æˆ–æ ‡è®°ä¸ºåºŸå¼ƒ

---

## 6. æ¨èä¿®å¤æ¸…å•

### é«˜ä¼˜å…ˆçº§ ğŸ”´
1. âœ… ä¿®å¤ `qrcode.react` å¯¼å…¥é”™è¯¯
2. âœ… åˆ é™¤æ‰€æœ‰è°ƒè¯•é¡µé¢
3. âœ… æ¸…ç†é—ç•™çš„ localStorage å­˜å‚¨é€»è¾‘

### ä¸­ä¼˜å…ˆçº§ ğŸŸ¡
1. ä¿®å¤ Navbar äº‹ä»¶å¤„ç†å™¨è­¦å‘Š
2. ä¼˜åŒ–é”™è¯¯å¤„ç†
3. æ·»åŠ è¾“å…¥éªŒè¯

### ä½ä¼˜å…ˆçº§ ğŸŸ¢
1. æ€§èƒ½ä¼˜åŒ–
2. UI/UX æ”¹è¿›
3. æ·»åŠ æµ‹è¯•

---

## 7. æ€»ç»“

### âœ… æ¶æ„çŠ¶æ€
- **å‰åç«¯åˆ†ç¦»**: å·²å®ç°
- **æ•°æ®å­˜å‚¨**: å®Œå…¨ä½¿ç”¨ Supabase (localStorage ä»…ç”¨äºä¼šè¯)
- **éƒ¨ç½²å‡†å¤‡**: å‡†å¤‡å°±ç»ª
- **åŠŸèƒ½å®Œæ•´æ€§**: æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®ç°

### âš ï¸ å¾…å¤„ç†é—®é¢˜
- 1ä¸ªä¸¥é‡é—®é¢˜ (qrcode.react)
- å¤šä¸ªè­¦å‘Šä¿¡æ¯
- é—ç•™è°ƒè¯•ä»£ç 

### ğŸ“Š æ•´ä½“è¯„åˆ†
- **æ¶æ„è®¾è®¡**: â­â­â­â­â­ (5/5)
- **æ•°æ®ç®¡ç†**: â­â­â­â­â˜† (4/5)
- **ä»£ç è´¨é‡**: â­â­â­â­â˜† (4/5)
- **éƒ¨ç½²å‡†å¤‡**: â­â­â­â­â­ (5/5)

### ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. ä¿®å¤ `qrcode.react` å¯¼å…¥é”™è¯¯
2. æ¸…ç†è°ƒè¯•é¡µé¢å’Œé—ç•™ä»£ç 
3. è¿è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•
4. å‡†å¤‡éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ





